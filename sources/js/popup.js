const contentArr = [
    {
        title: 'Специальная оценка условий труда',
        intro: `<p>Согласно Федеральному закону от 28 декабря 2013 г. № 426-ФЗ «О специальной оценке условий труда» любое
                   предприятие обязано организовать проведение специальной оценки условий труда.
                </p>
                <p>
                    Штраф за нарушение порядка проведения СОУТ в 2018 году в соответствии со ст. 5.27.1 КоАП РФ составляет
                    от 60 до 80 тысяч рублей на юридическое лицо.
                </p>
                <p>
                    Наша компания поможет организовать процесс проведения специальной оценки условий труда с соблюдением 
                    сроков, графиков и документарного обеспечения
                </p>`
    },
    {
        title: 'Знаки безопасности и сигнальная разметка',
        intro: `<p>Для обеспечения безопасности на предприятии и предупреждения рисков получения травм сотрудниками обеспечивается
                   обозначение мест с наибольшим риском при помощи знаков безопасности и сигнальной разметки по ГОСТ 12.4.026-2015 
                   ЦВЕТА СИГНАЛЬНЫЕ, ЗНАКИ БЕЗОПАСНОСТИ И РАЗМЕТКА СИГНАЛЬНАЯ
               </p>
                <p>
                    Мы поможем определить места и тип знаков под каждое предприятие, разработав проект и обеспечив поставку знаков
               </p>`
    },
    {
        title: 'Аутсорсинг охраны труда',
        intro: `<p>
                    Согласно ст.212 Обязанности по обеспечению безопасных условий и охраны труда возлагаются на работодателя. Данную
                    функцию можно возложить по договору на организацию, оказывающие услуги в области охраны труда. Основные 
                    преимущества такого сотрудничества:
                </p>
                <ul>
                <li>
                                    Значительное сокращение бюджета (в 2-3 раза) при организации охраны труда
                                </li>
                                <li>
                                Более качественное и своевременное оказание услуг за счет большого опыта работы с клиентами разного профиля и регулярного прохождения проверок надзорными органами</li>
                        
                        <li>
                        Регулярное отслеживание изменений законодательства и оказание методической помощи руководителям для поддержания организации охраны труда на высочайшем уровне
                        </li>
                        
                       <li>
                       Реальный контроль соблюдения требований законодательства на предприятии</li>
                        
                        
                        <ul>
                            В услуги аутсорсинга входит:
                        </ul>
                            <li>
                                осуществление функций специалиста по охране труда
                            </li>
                            <li>
                                организация и контроль за функционированием системы управления охраной труда
                            </li>
                            <li>
                                разработка полного пакета документов в соответствии со спецификой каждого предприятия
                            </li>
                            <li>
                                контроль за поддержанием документации в актуальном состоянии
                            </li>
                            <li>
                                рганизация медосмотров и психиатрических освидетельствований
                            </li>
                            <li>
                                организация и контроль за своевременным прохождением всех необходимых обучений
                            </li><li>
                                организация и выдача СИЗ для сотрудников
                            </li>
                            <li>
                                аудит и разработка мер по устранению выявленных нарушений требований охраны труда на предприятии для обеспечения безопасности сотрудников
                            </li>
                            <li>
                                представление интересов организации в надзорных органах и при взаимодействии с другими организациями
                            </li>
                       </ul>`
    },
    {
        title: 'Аудит по охране труда',
        intro: `<p>Независимо от наличия штатного специалиста по охране труда для всех предприятий важна независимая 
                    оценка действующей системы функционирования охраны труда на предприятии. Опытные специалисты 
                    компании проведут качественный и полнейший аудит охраны труда на предприятии с учетом опыта 
                    взаимодействия с клиентами различного профиля, действующего законодательства и прохождения 
                    проверок надзорными органами.
                </p>
                <p>В услугу аудит входит:</p>
                    
                <ul>
                    <li>аудит документации по охране труда</li>
                                        
                    <li>аудит физических нарушений на предприятии</li>
                    
                    <li>составление отчета и рекомендаций по устранению нарушений</li>
                </ul>`
    },
    {
        title: 'Разработка документов по охране труда',
        intro: `<p>Любая организация обязана иметь и вести определенную документацию по охране труда.</p>
                <p>В пакет документов входит:</p>
                <ul>
                    <li>журналы по охране труда</li>
                    <li>приказы</li>
                    <li>перечни</li>
                    <li>положения</li>
                    <li>программы инструктажей</li>
                    <li>инструкции</li>
                    <li>программы обучения</li>
                    <li>карточки СИЗ</li>
                    <li>документы по обучению сотрудников</li>
                    <li>документы для прохождения медосмотров, психиатрических освидетельствований</li>
                    <li>И многое другое в зависимости от специфики предприятия</li>
                    <li>Данная услуга будет выполнена качественно и в срок опытными специалистами с инструкциями по работе с документами.</li>
                </ul>`
    },

    {
        title: 'Разработка транспортных схем',
        intro: `<p>согласно п. 4.2.5 Постановления Минтруда РФ
                    от 12.05.2003 г. № 28
                    «Об утверждении Межотраслевых правил по охране труда на автомобильном транспорте»
                    Работодатель обязан разработать транспортную схему при движении любых видов техники по территории организации
                    Специалисты нашей компании помогут разработать схемы движения под любое предприятие
                </p>`
    }
];


const modalPopup = (function() {
    
    let popupContent;
    let activeItem;
    let popUpTitle;
    let popUpIntro;
    let navListItem;
    let popup;
    let popupSlideinContent;
    let popupNavbar;
    let popupNavbarListItem;
    let hamburger;
    let hamburgerClosed;
    let popupNavList;
    let hambOpenClose;
    let iconWrapperHamb;
    let iconWrapperClose;
    let iconWrapper;

    function open(idx, target) {
        document.documentElement.style.overflow = 'hidden';
        scrollBtn.style.display = 'none';
        activeItem = idx;
        const templateStore = getTemplate(popupContent, idx);
        target.insertAdjacentHTML('beforeEnd', templateStore);
        popupAnimation();
        addHandlers();
        setActiveItem(idx);
        //document.querySelector('.popup-content').style.overflow = 'auto'
    }

    function addHandlers() {
        document.querySelector('#left').addEventListener('click', _prevItem);
        document.querySelector('#right').addEventListener('click', _nextItem);
        document.querySelector('.popup__close').addEventListener('click', _close);
        document.body.addEventListener('keydown', keyHandler);
        document.querySelector('.hamburger__open-close').addEventListener('click', onClickHamburger);
        document.querySelector('.icon-wrapper__hamb').addEventListener('click', event => {
            let target = event.currentTarget;
            target.style.display='none';
            target.offsetHeight;
            target.style.display='block';
            console.log(target);
            //event.currentTarget.style.width = event.currentTarget.offsetWidth + 'px'
        });

        document.querySelector('.hamburger').addEventListener('click', el => {
           let t = el.target;
           if (t.classList.contains('hamburger')) {
               onClickHamburger()
           }
        });
        popUpTitle = document.querySelector('.popup__title');
        popUpIntro = document.querySelector('.popup__intro');
        navListItem = document.querySelectorAll('.popupnav-list__item');
        [].forEach.call(navListItem, (el, idx) => {
            el.addEventListener('click', event => setActiveItem(idx))
        });
    }

    function _prevItem() {
        setActiveItem(activeItem > 0 ? activeItem - 1 : popupContent.length - 1);
    }

    function _nextItem() {
        setActiveItem(activeItem < popupContent.length - 1 ? activeItem + 1 : 0);
    }

    function setActiveItem(idx) {
        popUpTitle.innerHTML =  popupContent[idx].title;
        popUpIntro.innerHTML =  popupContent[idx].intro;
        _setNavListItem(idx);
    }

    function _setNavListItem(idx) {
        navListItem[activeItem].style.background = 'none';
        navListItem[idx].style.background = "rgba(49, 196, 189, 0.44)";
        activeItem = idx;
    }


    function _close() {
        document.querySelector('#popup').remove();
        document.documentElement.style.overflow = '';
        scrollBtn.style.display = 'flex';
        document.body.removeEventListener('keydown', keyHandler)
    }

    function init(content) {
        popupContent = content;
    }

    function keyHandler (event) {
        if (event.key === 'ArrowLeft') {
            _prevItem()
        } else if (event.key === 'ArrowRight') {
            _nextItem()
        } else if (event.key === 'Escape') {
            _close()
        }
    }

    function onClickHamburger() {
        popupNavbar = document.querySelector('.popupnav');
        popupNavbar.classList.toggle('popupnav--closed');
        hamburger = document.querySelector('.hamburger');
        hamburger.classList.toggle('hamburger--opened');
    }

    function popupAnimation() {
        popup = document.querySelector('.popup');
        popupSlideinContent = document.querySelector('.popup-content');
        //hamburger = document.querySelector('.hamburger');
        hamburgerClosed = document.querySelector('.hamburger--closed');
        window.requestAnimationFrame(function () {
            growPopup();
            popupContentAppear();
        })
    }

    function growPopup() {
        let height = 0;
        let tId = setTimeout(function tick() {
            height += 10;
            popup.style.height = height + 'vh';
            if (height < 100) {
                tId = setTimeout(tick, 1);
            } else {
                popup.style.height = '100vh';
            }
        }, 1);
    }
    
    function popupContentAppear() {
        setTimeout (function() {
            popupSlideinContent.style.display = 'flex';
            //hamburger.style.display = 'block';
            if (document.documentElement.clientWidth > 520) {
                document.querySelector('#left').style.display = "block";
                document.querySelector('#right').style.display = "block";
            }
        }, 600);
    }

    function getTemplate(arr, idx) {
        let m  = [];
        let title = arr[idx].title;
        let intro = arr[idx].intro;
        arr.forEach( el => m.push(`<li class="popupnav-list__item">${el.title}</li>`));
        const res = m.join('');
        return `<div class="popup" id="popup">
                    <div class="hamburger">
                        <div class="hamburger__open-close">
                            <div class="icon-wrapper icon-wrapper__close">
                                <i class="material-icons  material-icons__close">clear</i>
                            </div>
                            <div class="icon-wrapper icon-wrapper__hamb">
                                <i class="material-icons material-icons__hamb">dehaze</i>
                            </div>
                        </div>
                        <div class="popupnav popupnav--closed" >
                            <ul class="popupnav-list">
                                ${res}
                            </ul>
                        </div>
                    </div>
                    <div class="popup__arrow" id="left">
                        <i class="material-icons">chevron_left</i>
                    </div>
                    <div class="popup-content">
                        <h2 class="popup__title" id="title">
                          ${title}
                        </h2>
                        <div class="popup__intro" id="intro">
                            ${intro}
                        </div>
                    </div>  
                    <div class="popup__arrow" id="right">
                        <i class="material-icons">chevron_right</i>
                    </div> 
                    <div class="popup__close" id="close">
                            <i class="material-icons material-icons__close">clear</i>                            
                    </div>
               </div>`
    }
    return {openModal: open,
            addContent: init}
})();

const target = document.querySelector('.services');
const items = document.querySelectorAll('.service');
modalPopup.addContent(contentArr);

[].forEach.call(items, function (el, idx) {
    el.addEventListener('click', (event) => {
        modalPopup.openModal(idx, target);
    });
});


